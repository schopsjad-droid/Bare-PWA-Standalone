# ๐ ุฅุนุฏุงุฏ ูุธุงู ุงูุฅุดุนุงุฑุงุช (Push Notifications)

## โ ูุง ุชู ุชูููุฐู

### 1. **Frontend Setup**
- โ ุฅุนุฏุงุฏ Firebase Messaging ูู `src/config/firebase.ts`
- โ ุฅูุดุงุก `src/utils/notifications.ts` ูุฅุฏุงุฑุฉ FCM Tokens
- โ ุชุญุฏูุซ `AuthContext` ูุทูุจ ุฅุฐู ุงูุฅุดุนุงุฑุงุช ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
- โ ุชุญุฏูุซ `public/firebase-messaging-sw.js` ูุงุณุชูุจุงู ุงูุฅุดุนุงุฑุงุช ูู ุงูุฎูููุฉ

### 2. **Backend Setup**
- โ ุฅูุดุงุก Cloud Function `sendMessageNotification` ูู `functions/index.js`
- โ ูุชู ุชุดุบูููุง ุชููุงุฆูุงู ุนูุฏ ุฅูุดุงุก ุฑุณุงูุฉ ุฌุฏูุฏุฉ
- โ ุชุฑุณู ุฅุดุนุงุฑ ูุฌููุน ุฃุฌูุฒุฉ ุงููุณุชูุจู

### 3. **Database Schema**
- โ ุฅุถุงูุฉ ุญูู `fcmTokens` (array) ูู ูุณุชูุฏุงุช ุงููุณุชุฎุฏููู
- โ ูุชู ุญูุธ Token ุชููุงุฆูุงู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู

---

## ๐ง ุฎุทูุงุช ุงูุฅุนุฏุงุฏ ุงูููุงุฆูุฉ

### **ุงูุฎุทูุฉ 1: ุงูุญุตูู ุนูู VAPID Key**

1. ุงูุชุญ Firebase Console:
   ```
   https://console.firebase.google.com/project/bare-android-app/settings/cloudmessaging
   ```

2. ุงุฐูุจ ุฅูู **Project Settings** โ **Cloud Messaging**

3. ูู ูุณู **Web Push certificates**:
   - ุฅุฐุง ูู ููู ููุงู keyุ ุงุถุบุท **Generate key pair**
   - ุงูุณุฎ ุงูู **Key pair** (ูุจุฏุฃ ุจู `B...`)

4. ุญุฏุซ ุงูููู `src/utils/notifications.ts`:
   ```typescript
   const token = await getToken(messaging, {
     vapidKey: 'YOUR_VAPID_KEY_HERE' // ุถุน ุงูู Key ููุง
   });
   ```

---

### **ุงูุฎุทูุฉ 2: ูุดุฑ Cloud Functions**

1. ุงูุชุญ Terminal ูู ูุฌูุฏ ุงููุดุฑูุน:
   ```bash
   cd functions
   npm install
   ```

2. ุงูุดุฑ ุงูู Functions:
   ```bash
   firebase deploy --only functions
   ```

3. ุชุฃูุฏ ูู ูุฌุงุญ ุงููุดุฑ ูู Firebase Console:
   ```
   https://console.firebase.google.com/project/bare-android-app/functions
   ```

---

### **ุงูุฎุทูุฉ 3: ุชุญุฏูุซ Firestore Schema**

ุฃุถู ุญูู `fcmTokens` ููุณุชูุฏุงุช ุงููุณุชุฎุฏููู:

```javascript
{
  uid: "...",
  username: "...",
  email: "...",
  fcmTokens: []  // โ ุฃุถู ูุฐุง ุงูุญูู
}
```

**ููุงุญุธุฉ:** ุณูุชู ุฅุถุงูุฉ ุงูุญูู ุชููุงุฆูุงู ุนูุฏ ุฃูู ุชุณุฌูู ุฏุฎูู ุจุนุฏ ุงููุดุฑ.

---

### **ุงูุฎุทูุฉ 4: ุงุฎุชุจุงุฑ ุงููุธุงู**

#### **ุฃ) ุงุฎุชุจุงุฑ ุทูุจ ุงูุฅุฐู:**
1. ุงูุชุญ ุงููููุน: https://bare-android-app.web.app
2. ุณุฌู ุฏุฎูู
3. ุจุนุฏ 2 ุซุงููุฉุ ูุฌุจ ุฃู ุชุธูุฑ ุฑุณุงูุฉ:
   ```
   "bare-android-app.web.app wants to show notifications"
   ```
4. ุงุถุบุท **Allow**

#### **ุจ) ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช:**
1. ุงูุชุญ ุงููููุน ูู ูุชุตูุญูู ูุฎุชูููู (ุฃู ุฌูุงุฒูู)
2. ุณุฌู ุฏุฎูู ุจุญุณุงุจูู ูุฎุชูููู
3. ุงููุณุชุฎุฏู A: ุฃูุดุฆ ุฅุนูุงู
4. ุงููุณุชุฎุฏู B: ุงูุชุญ ุงูุฅุนูุงู ูุงุถุบุท "ุฑุงุณู ุงูุจุงุฆุน"
5. ุงููุณุชุฎุฏู B: ุฃุฑุณู ุฑุณุงูุฉ
6. **ุงููุณุชุฎุฏู A ูุฌุจ ุฃู ูุณุชูุจู ุฅุดุนุงุฑ!** ๐

#### **ุฌ) ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช ูู ุงูุฎูููุฉ:**
1. ุงููุณุชุฎุฏู A: ุงุบูู ุงูุชุทุจูู (ุฃู ุงุฐูุจ ูุชุจููุจ ุขุฎุฑ)
2. ุงููุณุชุฎุฏู B: ุฃุฑุณู ุฑุณุงูุฉ
3. **ูุฌุจ ุฃู ูุธูุฑ ุฅุดุนุงุฑ ูู ูุธุงู ุงูุชุดุบูู!**

#### **ุฏ) ุงุฎุชุจุงุฑ ุงูููุฑ ุนูู ุงูุฅุดุนุงุฑ:**
1. ุงุถุบุท ุนูู ุงูุฅุดุนุงุฑ
2. **ูุฌุจ ุฃู ููุชุญ ุงูุชุทุจูู ููุฐูุจ ูุจุงุดุฑุฉ ูููุญุงุฏุซุฉ!**

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### **ุงููุดููุฉ: ูุง ุชุธูุฑ ุฑุณุงูุฉ ุทูุจ ุงูุฅุฐู**

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
- ุงููุชุตูุญ ูุง ูุฏุนู Notifications
- HTTPS ุบูุฑ ููุนู (ูุนูู ููุท ุนูู localhost ุฃู HTTPS)
- ุชู ุฑูุถ ุงูุฅุฐู ุณุงุจูุงู

**ุงูุญู:**
1. ุงูุชุญ DevTools โ Console
2. ุงุจุญุซ ุนู ุฑุณุงุฆู ุฎุทุฃ
3. ุชุฃูุฏ ูู ุฃู ุงููููุน ูุนูู ุนูู HTTPS
4. ุฅุฐุง ุฑูุถุช ุงูุฅุฐู ุณุงุจูุงู:
   - Chrome: Settings โ Privacy โ Site Settings โ Notifications
   - ุฃุฒู ุงููููุน ูู ุงููุงุฆูุฉ ุงููุญุธูุฑุฉ

---

### **ุงููุดููุฉ: ุงูุฅุดุนุงุฑุงุช ูุง ุชุตู**

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
- VAPID Key ุบูุฑ ุตุญูุญ
- Cloud Function ูู ูุชู ูุดุฑูุง
- FCM Token ูู ูุชู ุญูุธู

**ุงูุญู:**
1. ุชุญูู ูู VAPID Key ูู `src/utils/notifications.ts`
2. ุชุญูู ูู ูุดุฑ Cloud Functions:
   ```bash
   firebase deploy --only functions
   ```
3. ุชุญูู ูู ุญูุธ FCM Token:
   - ุงูุชุญ Firestore
   - ุงูุชุญ ูุณุชูุฏ ุงููุณุชุฎุฏู
   - ุชุฃูุฏ ูู ูุฌูุฏ ุญูู `fcmTokens` ูุน ููู

---

### **ุงููุดููุฉ: ุงูุฅุดุนุงุฑุงุช ุชุตู ููู ูุง ุชูุชุญ ุงููุญุงุฏุซุฉ**

**ุงูุณุจุจ:**
- Service Worker ูุง ูุนูู ุจุดูู ุตุญูุญ

**ุงูุญู:**
1. ุงูุชุญ Chrome DevTools โ Application โ Service Workers
2. ุงุถุบุท **Unregister** ููู Service Worker
3. ุญุฏุซ ุงูุตูุญุฉ
4. ุฌุฑุจ ูุฑุฉ ุฃุฎุฑู

---

## ๐ ูุฑุงูุจุฉ ุงูุฅุดุนุงุฑุงุช

### **Firebase Console:**
```
https://console.firebase.google.com/project/bare-android-app/functions/logs
```

ุงุจุญุซ ุนู:
- `New message in chat ...`
- `Sending notification to X devices`
- `Notification sent to token: ...`

### **Browser Console:**
```javascript
// ูู ุงููุฑุณู:
[Notifications] Permission granted
[Notifications] FCM Token: ...
[Notifications] Token saved to Firestore

// ูู ุงููุณุชูุจู:
[firebase-messaging-sw.js] Received background message: ...
[firebase-messaging-sw.js] Notification clicked: ...
```

---

## ๐ฏ ุงูุฎูุงุตุฉ

### **ูุง ูุนูู ุงูุขู:**
- โ ุทูุจ ุฅุฐู ุงูุฅุดุนุงุฑุงุช ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
- โ ุญูุธ FCM Tokens ูู Firestore
- โ ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุนูุฏ ุฅูุดุงุก ุฑุณุงูุฉ ุฌุฏูุฏุฉ
- โ ุงุณุชูุจุงู ุงูุฅุดุนุงุฑุงุช ูู ุงูุฎูููุฉ
- โ ูุชุญ ุงููุญุงุฏุซุฉ ุนูุฏ ุงูููุฑ ุนูู ุงูุฅุดุนุงุฑ
- โ ุญุฐู Tokens ุบูุฑ ุงูุตุงูุญุฉ ุชููุงุฆูุงู

### **ูุง ูุญุชุงุฌ ุฅุนุฏุงุฏ ูุฏูู:**
1. โ๏ธ ุฅุถุงูุฉ VAPID Key ูู `src/utils/notifications.ts`
2. โ๏ธ ูุดุฑ Cloud Functions: `firebase deploy --only functions`

---

## ๐ ููุงุญุธุงุช ูููุฉ

### **ุงูุฃูุงู:**
- FCM Tokens ุญุณุงุณุฉ - ูุง ุชุดุงุฑููุง ุนููุงู
- Cloud Functions ุชุนูู ุนูู ุฎูุงุฏู Google - ุขููุฉ
- ุงูุฅุดุนุงุฑุงุช ุชูุฑุณู ููุท ูููุณุชูุจู (ููุณ ุงููุฑุณู)

### **ุงูุฃุฏุงุก:**
- ุงูุฅุดุนุงุฑุงุช ุชูุฑุณู ููุฑุงู (< 1 ุซุงููุฉ)
- Cloud Functions ุชุนูู ุชููุงุฆูุงู (ูุง ุญุงุฌุฉ ูุฎุงุฏู)
- ูุฏุนู ุนุฏุฉ ุฃุฌูุฒุฉ ูููุณ ุงููุณุชุฎุฏู

### **ุงูุชูููุฉ:**
- Firebase Cloud Messaging: **ูุฌุงูู**
- Cloud Functions: **ูุฌุงูู** ุญุชู 125K ุงุณุชุฏุนุงุก/ุดูุฑ
- Firestore: **ูุฌุงูู** ุญุชู 50K ูุฑุงุกุฉ/ููู

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑูุฉ)

1. **ุฅุถุงูุฉ ุตูุช ููุฅุดุนุงุฑุงุช:**
   ```javascript
   const notificationOptions = {
     // ...
     sound: '/notification.mp3'
   };
   ```

2. **ุฅุถุงูุฉ ุตูุฑุฉ ูู ุงูุฅุดุนุงุฑ:**
   ```javascript
   const notificationOptions = {
     // ...
     image: chatData.adImage || '/logo-512.png'
   };
   ```

3. **ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ููุฅุนูุงูุงุช ุงูุฌุฏูุฏุฉ:**
   - Cloud Function ุนูุฏ ุฅูุดุงุก ุฅุนูุงู
   - ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชุฎุฏููู ุงูููุชููู

4. **ุฅุถุงูุฉ ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช:**
   - ุตูุญุฉ ูู ุงูุฅุนุฏุงุฏุงุช ูุชูุนูู/ุชุนุทูู ุงูุฅุดุนุงุฑุงุช
   - ุงุฎุชูุงุฑ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงููุฑุบูุจุฉ

---

**ุจุงูุชูููู! ๐**
